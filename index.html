<!DOCTYPE html>
<html lang="de">

<!--
read write protected with "sudo chflags uchg path/to/file" 
to revert run "sudo chflags nouchg path/to/file"
-->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>File Browser</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #0f0f11;
      --card-bg: #18181b;
      --hover-bg: #27272a;
      --text-primary: #f4f4f5;
      --text-secondary: #a1a1aa;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --border: #27272a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
      padding: 40px 20px;
    }

    header {
      margin-bottom: 40px;
      text-align: center;
      animation: fadeInDown 0.6s ease-out;
    }

    h1 {
      font-weight: 600;
      font-size: 2rem;
      margin: 0 0 10px 0;
      background: linear-gradient(to right, #fff, #a1a1aa);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .breadcrumbs {
      display: flex;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .breadcrumb-item {
      cursor: pointer;
      transition: color 0.2s;
    }

    .breadcrumb-item:hover {
      color: var(--text-primary);
      text-decoration: underline;
    }

    .breadcrumb-separator {
      opacity: 0.5;
    }

    #file-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }

    .item {
      display: flex;
      align-items: center;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-primary);
      transition: all 0.2s ease;
      cursor: pointer;
      animation: fadeIn 0.3s ease-out forwards;
      opacity: 0;
    }

    .item:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .icon {
      width: 24px;
      height: 24px;
      margin-right: 16px;
      flex-shrink: 0;
      fill: var(--text-secondary);
    }

    .item:hover .icon {
      fill: var(--accent);
    }

    .name {
      flex-grow: 1;
      font-weight: 500;
    }

    .meta {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .loading {
      text-align: center;
      color: var(--text-secondary);
      margin-top: 40px;
    }

    .error {
      color: #ef4444;
      text-align: center;
      padding: 20px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 8px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>

  <div class="container">
    <header>
      <h1>Repository Browser</h1>
      <div style="color: var(--text-secondary); font-size: 0.9rem; position: relative;">
        panik-144.github.io
        <a href="/Ducky_Control_Center/"
          style="position: absolute; right: -20px; top: 0; opacity: 0.1; color: var(--text-secondary); text-decoration: none; cursor: default;"
          title="???">Ï€</a>
      </div>
    </header>

    <div class="breadcrumbs" id="breadcrumbs"></div>
    <div id="file-list"></div>
  </div>

  <script>
    const REPO = "panik-144/panik-144.github.io";
    const BRANCH = "main";

    const ICONS = {
      folder: '<svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>',
      file: '<svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>',
      back: '<svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>'
    };

    const listEl = document.getElementById("file-list");
    const breadcrumbsEl = document.getElementById("breadcrumbs");

    // State
    let allFiles = [];
    let folderSizes = {};

    // Handle 404 Redirect
    (function handleRedirect() {
      if (sessionStorage.redirect) {
        const redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        const redirectUrl = new URL(redirect);
        history.replaceState(null, null, redirectUrl.pathname + redirectUrl.search);
      }
    })();

    async function initRepo() {
      listEl.innerHTML = '<div class="loading">Loading repository structure...</div>';

      try {
        // Fetch the entire tree recursively
        const apiUrl = `https://api.github.com/repos/${REPO}/git/trees/${BRANCH}?recursive=1`;
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error(`GitHub API Error: ${res.status}`);
        const data = await res.json();

        allFiles = data.tree;
        calculateFolderSizes();

        // Initial Render
        renderCurrentPath();
      } catch (err) {
        console.error(err);
        listEl.innerHTML = `<div class="error">Failed to load repository.<br>${err.message}</div>`;
      }
    }

    function calculateFolderSizes() {
      folderSizes = {};

      // Initialize all folders with 0
      allFiles.forEach(f => {
        if (f.type === "tree") {
          folderSizes[f.path] = 0;
        }
      });
      folderSizes[""] = 0; // Root

      // Sum up file sizes
      allFiles.forEach(f => {
        if (f.type === "blob") { // blob = file
          const size = f.size;
          const parts = f.path.split("/");

          // Add size to all parent folders
          let currentPath = "";
          parts.slice(0, -1).forEach((part, i) => {
            currentPath += (i === 0 ? "" : "/") + part;
            if (folderSizes[currentPath] !== undefined) {
              folderSizes[currentPath] += size;
            }
          });
          // Add to root
          folderSizes[""] += size;
        }
      });
    }

    function renderCurrentPath() {
      const path = location.pathname.replace(/^\//, "").replace(/\/$/, "");
      renderList(path);
      renderBreadcrumbs(path);
    }

    function renderList(currentPath) {
      listEl.innerHTML = "";

      // Filter items for current directory
      const contents = allFiles.filter(f => {
        const parentPath = f.path.substring(0, f.path.lastIndexOf("/"));
        // Handle root (parentPath is empty string if no slash)
        const fDir = f.path.includes("/") ? parentPath : "";
        return fDir === currentPath;
      });

      // Sort: Folders first, then files
      contents.sort((a, b) => {
        if (a.type === b.type) return a.name ? a.name.localeCompare(b.name) : a.path.localeCompare(b.path);
        return a.type === "tree" ? -1 : 1;
      });

      // Add ".." if not root
      if (currentPath) {
        const parentPath = currentPath.split("/").slice(0, -1).join("/");
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<div class="icon">${ICONS.back}</div><div class="name">..</div>`;
        div.onclick = (e) => {
          e.preventDefault();
          navigateTo(parentPath ? `/${parentPath}/` : "/");
        };
        listEl.appendChild(div);
      }

      contents.forEach((f, index) => {
        const name = f.path.split("/").pop();
        if (name === "index.html" || name === "404.html") return;

        const div = document.createElement("a");
        div.className = "item";
        div.style.animationDelay = `${index * 0.02}s`; // Faster animation

        if (f.type === "tree") { // Directory
          div.href = `/${f.path}/`;
          const size = folderSizes[f.path] || 0;
          div.innerHTML = `<div class="icon">${ICONS.folder}</div><div class="name">${name}</div><div class="meta">${formatSize(size)}</div>`;
          div.onclick = (e) => {
            e.preventDefault();
            navigateTo(`/${f.path}/`);
          };
        } else { // File
          div.href = `/${f.path}`;
          div.target = "_blank";
          div.innerHTML = `<div class="icon">${ICONS.file}</div><div class="name">${name}</div><div class="meta">${formatSize(f.size)}</div>`;
        }

        listEl.appendChild(div);
      });
    }

    function renderBreadcrumbs(path) {
      const parts = path.split("/").filter(p => p);
      let html = `<span class="breadcrumb-item" onclick="navigateTo('/')">root</span>`;

      let current = "";
      parts.forEach(part => {
        current += `/${part}`;
        const target = current + "/";
        html += ` <span class="breadcrumb-separator">/</span> <span class="breadcrumb-item" onclick="navigateTo('${target}')">${part}</span>`;
      });

      breadcrumbsEl.innerHTML = html;
    }

    function navigateTo(path) {
      history.pushState(null, null, path);
      renderCurrentPath();
    }

    function formatSize(bytes) {
      if (!bytes) return "0 B";
      const k = 1024;
      const sizes = ["B", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i];
    }

    window.addEventListener("popstate", renderCurrentPath);

    // Start
    initRepo();
  </script>
</body>

</html>