<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANIK BOY</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --gb-body: #c0c0c0;
            --gb-screen-border: #777;
            --gb-screen-bg: #9bbc0f;
            --gb-screen-dark: #0f380f;
            --gb-btn-a: #9f2238;
            --gb-btn-b: #9f2238;
            --gb-dpad: #333;
            --gb-select: #999;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
        }

        /* --- THE GAMEBOY --- */
        .gameboy {
            position: relative;
            width: 360px;
            height: 600px;
            background: var(--gb-body);
            border-radius: 20px 20px 50px 20px;
            box-shadow:
                inset 5px 5px 10px rgba(255, 255, 255, 0.4),
                inset -5px -5px 10px rgba(0, 0, 0, 0.2),
                10px 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
        }

        /* Screen Area */
        .screen-border {
            width: 300px;
            height: 240px;
            background: var(--gb-screen-border);
            border-radius: 15px 15px 40px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .power-led {
            position: absolute;
            top: 40%;
            left: 15px;
            width: 8px;
            height: 8px;
            background: #f00;
            border-radius: 50%;
            box-shadow: 0 0 5px #f00;
            opacity: 0.8;
        }

        .power-label {
            position: absolute;
            top: 40%;
            left: 30px;
            font-size: 8px;
            color: #ccc;
            transform: translateY(-2px);
        }

        .lcd {
            width: 220px;
            height: 180px;
            background: var(--gb-screen-bg);
            box-shadow: inset 3px 3px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            color: var(--gb-screen-dark);
        }

        /* Scanlines for LCD */
        .lcd::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.1));
            background-size: 100% 4px;
            pointer-events: none;
        }

        /* Nintendo Logo */
        .nintendo-logo {
            margin-top: 10px;
            font-size: 12px;
            color: #aaa;
            font-weight: bold;
            letter-spacing: 1px;
            font-family: sans-serif;
            font-style: italic;
        }

        /* Controls Area */
        .controls-area {
            width: 100%;
            flex-grow: 1;
            position: relative;
        }

        /* D-PAD */
        .dpad {
            position: absolute;
            top: 40px;
            left: 30px;
            width: 100px;
            height: 100px;
        }

        .dpad-h,
        .dpad-v {
            position: absolute;
            background: var(--gb-dpad);
            border-radius: 4px;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .dpad-h {
            top: 35px;
            left: 0;
            width: 100px;
            height: 30px;
        }

        .dpad-v {
            top: 0;
            left: 35px;
            width: 30px;
            height: 100px;
        }

        .dpad-center {
            position: absolute;
            top: 35px;
            left: 35px;
            width: 30px;
            height: 30px;
            background: var(--gb-dpad);
            z-index: 2;
        }

        /* Click zones for D-Pad */
        .dpad-btn {
            position: absolute;
            width: 35px;
            height: 35px;
            z-index: 10;
            cursor: pointer;
        }

        .dpad-btn:active {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.1);
        }

        .up {
            top: 0;
            left: 33px;
        }

        .down {
            bottom: 0;
            left: 33px;
        }

        .left {
            top: 33px;
            left: 0;
        }

        .right {
            top: 33px;
            right: 0;
        }

        /* A/B Buttons */
        .action-btns {
            position: absolute;
            top: 50px;
            right: 30px;
            width: 100px;
            height: 60px;
            transform: rotate(-25deg);
        }

        .btn-round {
            width: 35px;
            height: 35px;
            background: var(--gb-btn-a);
            border-radius: 50%;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.3);
            position: absolute;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(0, 0, 0, 0.3);
            font-size: 10px;
            font-family: sans-serif;
            font-weight: bold;
        }

        .btn-round:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3);
        }

        .btn-b {
            bottom: 0;
            left: 0;
        }

        .btn-a {
            top: 0;
            right: 0;
        }

        .label-b {
            position: absolute;
            bottom: -20px;
            left: 10px;
            font-size: 10px;
            color: var(--gb-dpad);
            font-family: sans-serif;
            font-weight: bold;
            transform: rotate(25deg);
        }

        .label-a {
            position: absolute;
            bottom: -20px;
            right: 10px;
            font-size: 10px;
            color: var(--gb-dpad);
            font-family: sans-serif;
            font-weight: bold;
            transform: rotate(25deg);
        }

        /* Start/Select */
        .option-btns {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .btn-pill {
            width: 50px;
            height: 12px;
            background: var(--gb-select);
            border-radius: 10px;
            transform: rotate(-25deg);
            box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
        }

        .btn-pill:active {
            transform: rotate(-25deg) translate(1px, 1px);
            box-shadow: none;
        }

        .label-pill {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%) rotate(25deg);
            font-size: 10px;
            color: var(--gb-dpad);
            font-family: sans-serif;
            font-weight: bold;
            white-space: nowrap;
        }

        /* --- SCREEN CONTENT --- */
        .carousel-item {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
        }

        .carousel-item.active {
            display: flex;
        }

        .icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .title {
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .meta {
            font-size: 8px;
            opacity: 0.7;
        }

        .loading-text {
            font-size: 10px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* Konami Flash */
        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            transition: opacity 0.1s;
        }

        /* Speaker */
        .speaker {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 80px;
            height: 60px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            transform: rotate(-25deg);
        }

        .speaker-hole {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
        }
    </style>
</head>

<body>

    <div class="flash-overlay" id="flash"></div>

    <div class="gameboy">
        <div class="screen-border">
            <div class="power-led"></div>
            <div class="power-label">BATTERY</div>
            <div class="lcd" id="lcd">
                <div class="loading-text">INSERT CARTRIDGE...</div>
            </div>
            <div class="nintendo-logo">Nintendo GAME BOY</div>
        </div>

        <div class="controls-area">
            <!-- D-PAD -->
            <div class="dpad">
                <div class="dpad-v"></div>
                <div class="dpad-h"></div>
                <div class="dpad-center"></div>
                <div class="dpad-btn up" onclick="handleInput('ArrowUp')"></div>
                <div class="dpad-btn down" onclick="handleInput('ArrowDown')"></div>
                <div class="dpad-btn left" onclick="handleInput('ArrowLeft')"></div>
                <div class="dpad-btn right" onclick="handleInput('ArrowRight')"></div>
            </div>

            <!-- A/B Buttons -->
            <div class="action-btns">
                <div class="btn-round btn-b" onclick="handleInput('b')"></div>
                <div class="label-b">B</div>
                <div class="btn-round btn-a" onclick="handleInput('a')"></div>
                <div class="label-a">A</div>
            </div>

            <!-- Start/Select -->
            <div class="option-btns">
                <div class="btn-pill" onclick="handleInput('Select')">
                    <div class="label-pill">SELECT</div>
                </div>
                <div class="btn-pill" onclick="handleInput('Enter')">
                    <div class="label-pill">START</div>
                </div>
            </div>

            <!-- Speaker -->
            <div class="speaker">
                <div class="speaker-hole"></div>
                <div class="speaker-hole"></div>
                <div class="speaker-hole"></div>
                <div class="speaker-hole"></div>
                <div class="speaker-hole"></div>
                <div class="speaker-hole"></div>
            </div>
        </div>
    </div>

    <script>
        const REPO = "panik-144/panik-144.github.io";
        const BRANCH = "main";
        const HIDDEN = ["Ducky_Control_Center", ".git", ".github", "old_index.html", "CNAME", "LICENSE", "README.md"];

        let allFiles = [];
        let currentItems = [];
        let currentIndex = 0;
        let currentPath = "";

        const lcd = document.getElementById('lcd');

        // --- Konami Code ---
        const konamiCode = ["ArrowUp", "ArrowUp", "ArrowDown", "ArrowDown", "ArrowLeft", "ArrowRight", "ArrowLeft", "ArrowRight", "b", "a"];
        let konamiIndex = 0;

        // --- Input Handling ---
        function handleInput(key) {
            // Normalize key
            const k = key.length === 1 ? key.toLowerCase() : key;

            // 1. Konami Logic
            const target = konamiCode[konamiIndex];
            const targetNorm = target.length === 1 ? target.toLowerCase() : target;

            if (k === targetNorm) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    activateKonami();
                    konamiIndex = 0;
                    return;
                }
            } else {
                konamiIndex = 0;
            }

            // 2. Navigation Logic
            if (currentItems.length === 0) return;

            if (key === "ArrowRight") {
                currentIndex = (currentIndex + 1) % currentItems.length;
                renderScreen();
            } else if (key === "ArrowLeft") {
                currentIndex = (currentIndex - 1 + currentItems.length) % currentItems.length;
                renderScreen();
            } else if (key === "Enter" || key === "a") { // Start or A to launch/enter
                enterItem();
            } else if (key === "b") { // B to go back
                if (currentPath !== "") {
                    goBack();
                }
            }
        }

        // Keyboard Listener
        document.addEventListener('keydown', (e) => {
            handleInput(e.key);
        });

        function activateKonami() {
            const flash = document.getElementById('flash');
            flash.style.opacity = 1;
            setTimeout(() => {
                flash.style.opacity = 0;
                window.location.href = "/Ducky_Control_Center/";
            }, 200);
        }

        function enterItem() {
            const item = currentItems[currentIndex];
            if (!item) return;

            // Blink effect
            lcd.style.background = "#0f380f";
            setTimeout(() => {
                lcd.style.background = "#9bbc0f"; // Reset bg

                if (item.type === "DIR") {
                    // Enter Folder
                    currentPath = item.path;
                    updateCurrentItems();
                } else {
                    // Open File
                    window.location.href = item.path;
                }
            }, 100);
        }

        function goBack() {
            // Go up one level
            const parts = currentPath.split("/");
            parts.pop();
            currentPath = parts.join("/");
            updateCurrentItems();
        }

        async function init() {
            try {
                // Fetch RECURSIVE tree
                const res = await fetch(`https://api.github.com/repos/${REPO}/git/trees/${BRANCH}?recursive=1`);
                if (!res.ok) throw new Error("API Error");
                const data = await res.json();

                allFiles = data.tree;
                updateCurrentItems();

            } catch (err) {
                console.error(err);
                lcd.innerHTML = '<div class="loading-text">LINK ERROR</div>';
            }
        }

        function updateCurrentItems() {
            // Filter files for currentPath
            currentItems = allFiles.filter(f => {
                // 1. Hide hidden files/folders (recursively)
                if (HIDDEN.some(h => f.path.startsWith(h))) return false;
                if (f.path.split('/').some(p => p.startsWith('.'))) return false; // Hide dotfiles

                // 2. Check if file is in currentPath
                const parentPath = f.path.substring(0, f.path.lastIndexOf("/"));
                const fDir = f.path.includes("/") ? parentPath : "";

                return fDir === currentPath;
            }).map(f => ({
                name: f.path.split('/').pop(),
                path: f.path,
                type: f.type === "tree" ? "DIR" : "FILE"
            }));

            // Sort: DIRs first, then FILEs
            currentItems.sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === "DIR" ? -1 : 1;
            });

            currentIndex = 0;
            renderScreen();
        }

        function renderScreen() {
            if (currentItems.length === 0) {
                lcd.innerHTML = '<div class="loading-text">EMPTY FOLDER</div>';
                return;
            }

            const item = currentItems[currentIndex];

            // Icon Logic
            let icon = "ðŸ“„";
            if (item.type === "DIR") icon = "ðŸ“";
            if (item.name.toLowerCase().includes("ducky")) icon = "ðŸ¦†";
            if (item.name.toLowerCase().includes("binaries")) icon = "010";
            if (item.name.toLowerCase().includes("audio")) icon = "ðŸŽµ";
            if (item.name.endsWith(".png") || item.name.endsWith(".jpg")) icon = "ðŸ–¼ï¸";
            if (item.name.endsWith(".html")) icon = "ðŸŒ";

            // Path Display (Breadcrumb style or just current folder)
            const displayPath = currentPath === "" ? "ROOT" : "> " + currentPath.split('/').pop();

            lcd.innerHTML = `
                <div class="carousel-item active">
                    <div style="font-size: 8px; margin-bottom: 5px; opacity: 0.6;">${displayPath}</div>
                    <div class="icon">${icon}</div>
                    <div class="title">${item.name}</div>
                    <div class="meta">&lt; ${currentIndex + 1}/${currentItems.length} &gt;</div>
                </div>
            `;
        }

        init();
    </script>
</body>

</html>